{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/src/middleware.ts"],"sourcesContent":["import { NextResponse } from 'next/server'\r\nimport type { NextRequest } from 'next/server'\r\n\r\n// Simple in-memory rate limiting (use Redis in production)\r\nconst rateLimit = new Map<string, { count: number; resetTime: number }>()\r\n\r\nconst RATE_LIMIT_WINDOW = 60 * 1000 // 1 minute\r\nconst MAX_REQUESTS = 60 // 60 requests per minute\r\n\r\nfunction getRateLimitKey(request: NextRequest): string {\r\n  // Use IP address or a combination of IP and user agent\r\n  const forwarded = request.headers.get('x-forwarded-for')\r\n  const realIp = request.headers.get('x-real-ip')\r\n  const ip = forwarded ? forwarded.split(',')[0] : realIp || 'unknown'\r\n  return ip\r\n}\r\n\r\nfunction checkRateLimit(key: string): boolean {\r\n  const now = Date.now()\r\n  const record = rateLimit.get(key)\r\n\r\n  if (!record || now > record.resetTime) {\r\n    rateLimit.set(key, {\r\n      count: 1,\r\n      resetTime: now + RATE_LIMIT_WINDOW,\r\n    })\r\n    return true\r\n  }\r\n\r\n  if (record.count >= MAX_REQUESTS) {\r\n    return false\r\n  }\r\n\r\n  record.count++\r\n  return true\r\n}\r\n\r\n// Clean up old entries periodically\r\nsetInterval(() => {\r\n  const now = Date.now()\r\n  for (const [key, record] of rateLimit.entries()) {\r\n    if (now > record.resetTime) {\r\n      rateLimit.delete(key)\r\n    }\r\n  }\r\n}, 5 * 60 * 1000) // Clean every 5 minutes\r\n\r\nexport function middleware(request: NextRequest) {\r\n  // Skip rate limiting for static assets\r\n  if (\r\n    request.nextUrl.pathname.startsWith('/_next') ||\r\n    request.nextUrl.pathname.startsWith('/images') ||\r\n    request.nextUrl.pathname.startsWith('/icons') ||\r\n    request.nextUrl.pathname.startsWith('/manifest.json')\r\n  ) {\r\n    return NextResponse.next()\r\n  }\r\n\r\n  // Apply rate limiting to API routes\r\n  if (request.nextUrl.pathname.startsWith('/api')) {\r\n    const key = getRateLimitKey(request)\r\n    \r\n    if (!checkRateLimit(key)) {\r\n      return NextResponse.json(\r\n        { error: 'Too many requests. Please try again later.' },\r\n        { \r\n          status: 429,\r\n          headers: {\r\n            'Retry-After': '60',\r\n          },\r\n        }\r\n      )\r\n    }\r\n\r\n    // Add security headers\r\n    const response = NextResponse.next()\r\n    response.headers.set('X-Content-Type-Options', 'nosniff')\r\n    response.headers.set('X-Frame-Options', 'DENY')\r\n    response.headers.set('X-XSS-Protection', '1; mode=block')\r\n    response.headers.set('Referrer-Policy', 'strict-origin-when-cross-origin')\r\n    \r\n    return response\r\n  }\r\n\r\n  // Add security headers to all responses\r\n  const response = NextResponse.next()\r\n  response.headers.set('X-Content-Type-Options', 'nosniff')\r\n  response.headers.set('X-Frame-Options', 'SAMEORIGIN')\r\n  response.headers.set('X-XSS-Protection', '1; mode=block')\r\n  response.headers.set('Referrer-Policy', 'strict-origin-when-cross-origin')\r\n  \r\n  return response\r\n}\r\n\r\nexport const config = {\r\n  matcher: [\r\n    /*\r\n     * Match all request paths except for the ones starting with:\r\n     * - _next/static (static files)\r\n     * - _next/image (image optimization files)\r\n     * - favicon.ico (favicon file)\r\n     */\r\n    '/((?!_next/static|_next/image|favicon.ico).*)',\r\n  ],\r\n}\r\n"],"names":[],"mappings":";;;;;;AAAA;AAAA;;AAGA,2DAA2D;AAC3D,MAAM,YAAY,IAAI;AAEtB,MAAM,oBAAoB,KAAK,KAAK,WAAW;;AAC/C,MAAM,eAAe,GAAG,yBAAyB;;AAEjD,SAAS,gBAAgB,OAAoB;IAC3C,uDAAuD;IACvD,MAAM,YAAY,QAAQ,OAAO,CAAC,GAAG,CAAC;IACtC,MAAM,SAAS,QAAQ,OAAO,CAAC,GAAG,CAAC;IACnC,MAAM,KAAK,YAAY,UAAU,KAAK,CAAC,IAAI,CAAC,EAAE,GAAG,UAAU;IAC3D,OAAO;AACT;AAEA,SAAS,eAAe,GAAW;IACjC,MAAM,MAAM,KAAK,GAAG;IACpB,MAAM,SAAS,UAAU,GAAG,CAAC;IAE7B,IAAI,CAAC,UAAU,MAAM,OAAO,SAAS,EAAE;QACrC,UAAU,GAAG,CAAC,KAAK;YACjB,OAAO;YACP,WAAW,MAAM;QACnB;QACA,OAAO;IACT;IAEA,IAAI,OAAO,KAAK,IAAI,cAAc;QAChC,OAAO;IACT;IAEA,OAAO,KAAK;IACZ,OAAO;AACT;AAEA,oCAAoC;AACpC,YAAY;IACV,MAAM,MAAM,KAAK,GAAG;IACpB,KAAK,MAAM,CAAC,KAAK,OAAO,IAAI,UAAU,OAAO,GAAI;QAC/C,IAAI,MAAM,OAAO,SAAS,EAAE;YAC1B,UAAU,MAAM,CAAC;QACnB;IACF;AACF,GAAG,IAAI,KAAK,OAAM,wBAAwB;AAEnC,SAAS,WAAW,OAAoB;IAC7C,uCAAuC;IACvC,IACE,QAAQ,OAAO,CAAC,QAAQ,CAAC,UAAU,CAAC,aACpC,QAAQ,OAAO,CAAC,QAAQ,CAAC,UAAU,CAAC,cACpC,QAAQ,OAAO,CAAC,QAAQ,CAAC,UAAU,CAAC,aACpC,QAAQ,OAAO,CAAC,QAAQ,CAAC,UAAU,CAAC,mBACpC;QACA,OAAO,gMAAY,CAAC,IAAI;IAC1B;IAEA,oCAAoC;IACpC,IAAI,QAAQ,OAAO,CAAC,QAAQ,CAAC,UAAU,CAAC,SAAS;QAC/C,MAAM,MAAM,gBAAgB;QAE5B,IAAI,CAAC,eAAe,MAAM;YACxB,OAAO,gMAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAA6C,GACtD;gBACE,QAAQ;gBACR,SAAS;oBACP,eAAe;gBACjB;YACF;QAEJ;QAEA,uBAAuB;QACvB,MAAM,WAAW,gMAAY,CAAC,IAAI;QAClC,SAAS,OAAO,CAAC,GAAG,CAAC,0BAA0B;QAC/C,SAAS,OAAO,CAAC,GAAG,CAAC,mBAAmB;QACxC,SAAS,OAAO,CAAC,GAAG,CAAC,oBAAoB;QACzC,SAAS,OAAO,CAAC,GAAG,CAAC,mBAAmB;QAExC,OAAO;IACT;IAEA,wCAAwC;IACxC,MAAM,WAAW,gMAAY,CAAC,IAAI;IAClC,SAAS,OAAO,CAAC,GAAG,CAAC,0BAA0B;IAC/C,SAAS,OAAO,CAAC,GAAG,CAAC,mBAAmB;IACxC,SAAS,OAAO,CAAC,GAAG,CAAC,oBAAoB;IACzC,SAAS,OAAO,CAAC,GAAG,CAAC,mBAAmB;IAExC,OAAO;AACT;AAEO,MAAM,SAAS;IACpB,SAAS;QACP;;;;;KAKC,GACD;KACD;AACH"}}]
}